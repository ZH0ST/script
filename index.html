<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whitelist Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: #0a0a0a; color: white; min-height: 100vh; padding: 20px; }
        
        .container { max-width: 1200px; margin: 0 auto; }
        
        .header { text-align: center; padding: 40px 0; background: #111; border-radius: 15px; margin-bottom: 30px; border: 2px solid #00aaff; }
        .header h1 { color: #00aaff; font-size: 2.8rem; margin-bottom: 10px; }
        .header p { color: #aaa; font-size: 1.1rem; }
        
        .dashboard { display: grid; grid-template-columns: 1fr 350px; gap: 25px; }
        
        .users-list { background: #111; border-radius: 15px; padding: 25px; border: 1px solid #333; }
        .users-list h2 { color: #00aaff; margin-bottom: 25px; font-size: 1.8rem; border-bottom: 2px solid #00aaff; padding-bottom: 10px; }
        
        .user-card { background: #1a1a1a; border-radius: 10px; padding: 20px; margin-bottom: 20px; display: flex; align-items: center; border-left: 5px solid #00aaff; }
        .user-avatar { width: 60px; height: 60px; border-radius: 50%; margin-right: 20px; border: 3px solid #00aaff; }
        .user-info { flex: 1; }
        .user-name { font-weight: bold; color: white; font-size: 1.2rem; }
        .user-id { color: #aaa; font-size: 1rem; margin: 5px 0; }
        .user-added { color: #888; font-size: 0.9rem; }
        .remove-btn { background: linear-gradient(135deg, #ff4444, #cc0000); color: white; border: none; padding: 8px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .remove-btn:hover { background: linear-gradient(135deg, #ff6666, #ff0000); }
        
        .add-user { background: #111; border-radius: 15px; padding: 25px; border: 1px solid #333; }
        .add-user h2 { color: #00ffaa; margin-bottom: 25px; font-size: 1.8rem; border-bottom: 2px solid #00ffaa; padding-bottom: 10px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; color: #88ccff; margin-bottom: 8px; font-size: 1.1rem; }
        .form-group input { width: 100%; padding: 12px; background: #222; border: 2px solid #00aaff; border-radius: 8px; color: white; font-size: 1rem; }
        .add-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #00aaff, #0088cc); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .add-btn:hover { background: linear-gradient(135deg, #00bbff, #0099dd); transform: translateY(-2px); }
        .add-btn:active { transform: translateY(0); }
        
        .status { padding: 15px; border-radius: 8px; margin-top: 15px; text-align: center; display: none; font-weight: bold; }
        .success { background: rgba(0,255,0,0.15); color: #00ff00; border: 2px solid #00ff00; }
        .error { background: rgba(255,0,0,0.15); color: #ff5555; border: 2px solid #ff5555; }
        
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #111; padding: 25px; border-radius: 12px; text-align: center; border: 1px solid #333; }
        .stat-number { font-size: 2.5rem; color: #00ffaa; font-weight: bold; margin-bottom: 10px; }
        .stat-label { color: #aaa; font-size: 1rem; }
        
        .loading { text-align: center; padding: 40px; color: #888; }
        
        @media (max-width: 1000px) {
            .dashboard { grid-template-columns: 1fr; }
            .stats { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 600px) {
            .stats { grid-template-columns: 1fr; }
            .header h1 { font-size: 2rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîí WHITELIST DASHBOARD</h1>
            <p>Manage access to your Roblox scripts</p>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalUsers">0</div>
                <div class="stat-label">Total Whitelisted Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="lastUpdated">-</div>
                <div class="stat-label">Last Updated</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="apiStatus">Loading...</div>
                <div class="stat-label">System Status</div>
            </div>
        </div>
        
        <div class="dashboard">
            <div class="users-list">
                <h2>üìã WHITELISTED USERS</h2>
                <div id="usersContainer">
                    <div class="loading">Loading users...</div>
                </div>
            </div>
            
            <div class="add-user">
                <h2>‚ûï ADD NEW USER</h2>
                <div class="form-group">
                    <label>Roblox User ID:</label>
                    <input type="number" id="userId" placeholder="e.g., 10428355122">
                </div>
                <div class="form-group">
                    <label>Roblox Username:</label>
                    <input type="text" id="username" placeholder="e.g., RobloxPlayer">
                </div>
                <button class="add-btn" onclick="addUser()">Add to Whitelist</button>
                <div class="status" id="status"></div>
                
                <div style="margin-top: 25px; padding: 15px; background: rgba(0,100,200,0.1); border-radius: 8px; border: 1px solid #00aaff;">
                    <h3 style="color: #88ccff; margin-bottom: 10px;">‚ÑπÔ∏è How to Use</h3>
                    <p style="color: #aaa; font-size: 0.9rem; line-height: 1.5;">
                        1. Enter Roblox User ID and Username<br>
                        2. Click "Add to Whitelist"<br>
                        3. User can now use your scripts<br>
                        4. Remove users with the red button
                    </p>
                </div>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 40px; color: #666; font-size: 0.9rem;">
            <p>Whitelist System v1.0 ‚Ä¢ Auto-updates every 30 seconds</p>
        </div>
    </div>

    <script>
        // CONFIGURATION
        const YOUR_VERCEL_URL = "https://script-one-zeta.vercel.app";
        const GITHUB_USERNAME = 'ZH0ST';
        const REPO_NAME = 'script';
        
        const WHITELIST_DATA_KEY = 'whitelist_data';
        let currentData = null;
        
        // Load initial data
        async function loadInitialData() {
            console.log('Loading whitelist data...');
            
            // Try YOUR API endpoint first (most reliable)
            try {
                const apiResponse = await fetch(`${YOUR_VERCEL_URL}/api/check?userId=test`);
                if (apiResponse.ok) {
                    // API is working, now try to get full list
                    await loadFromGitHub();
                    return;
                }
            } catch (apiError) {
                console.log('API test failed, trying direct GitHub...');
            }
            
            // Fallback to GitHub
            await loadFromGitHub();
        }
        
        // Load from GitHub
        async function loadFromGitHub() {
            const GITHUB_URL = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${REPO_NAME}/main/whitelisted-users.json`;
            
            try {
                document.getElementById('apiStatus').textContent = 'üîÑ Fetching...';
                document.getElementById('apiStatus').style.color = '#ffaa00';
                
                const response = await fetch(GITHUB_URL + '?t=' + Date.now());
                
                if (!response.ok) {
                    throw new Error(`GitHub HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Successfully loaded from GitHub:', data);
                
                // Validate data
                if (!data.users || !Array.isArray(data.users)) {
                    throw new Error('Invalid data format from GitHub');
                }
                
                currentData = data;
                localStorage.setItem(WHITELIST_DATA_KEY, JSON.stringify(data));
                
                updateDisplay();
                showStatus('‚úÖ Data loaded from GitHub!', 'success');
                
                document.getElementById('apiStatus').textContent = 'üü¢ Online';
                document.getElementById('apiStatus').style.color = '#00ff00';
                
            } catch (error) {
                console.error('GitHub load failed:', error);
                
                // Try to load from localStorage
                const savedData = localStorage.getItem(WHITELIST_DATA_KEY);
                if (savedData) {
                    try {
                        currentData = JSON.parse(savedData);
                        updateDisplay();
                        showStatus('Loaded from local cache', 'success');
                        document.getElementById('apiStatus').textContent = 'üü° Local Cache';
                        document.getElementById('apiStatus').style.color = '#ffaa00';
                        return;
                    } catch (e) {
                        console.error('Local cache error:', e);
                    }
                }
                
                // Create default data
                createDefaultData();
                showStatus('‚ö†Ô∏è Using default data - check GitHub file', 'error');
                document.getElementById('apiStatus').textContent = 'üî¥ Offline';
                document.getElementById('apiStatus').style.color = '#ff5555';
            }
        }
        
        // Create default data
        function createDefaultData() {
            currentData = {
                users: [
                    {
                        userId: "10428355122",
                        username: "YourUsername",
                        profileImage: "https://tr.rbxcdn.com/10428355122/150/150/Image/Png",
                        addedAt: new Date().toISOString(),
                        addedBy: "system"
                    }
                ],
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem(WHITELIST_DATA_KEY, JSON.stringify(currentData));
            updateDisplay();
        }
        
        // Update display with current data
        function updateDisplay() {
            if (!currentData) return;
            
            // Update stats
            document.getElementById('totalUsers').textContent = currentData.users.length;
            document.getElementById('lastUpdated').textContent = new Date(currentData.lastUpdated).toLocaleString();
            
            // Display users
            displayUsers(currentData.users);
        }
        
        // Display users in list
        function displayUsers(users) {
            const container = document.getElementById('usersContainer');
            
            if (users.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #666; font-size: 1.1rem;">No whitelisted users yet. Add your first user!</div>';
                return;
            }
            
            let html = '';
            users.forEach(user => {
                const date = new Date(user.addedAt);
                const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                html += `
                    <div class="user-card">
                        <img src="${user.profileImage || `https://tr.rbxcdn.com/${user.userId}/150/150/Image/Png`}" 
                             class="user-avatar" 
                             alt="${user.username}"
                             onerror="this.src='https://tr.rbxcdn.com/5280b2c9e6b95b44e1c2e5c5a2b5b5b5/150/150/Image/Png'">
                        <div class="user-info">
                            <div class="user-name">${user.username || 'Unknown'}</div>
                            <div class="user-id">ID: ${user.userId}</div>
                            <div class="user-added">Added: ${formattedDate} by ${user.addedBy || 'dashboard'}</div>
                        </div>
                        <button class="remove-btn" onclick="removeUser('${user.userId}')">Remove</button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Add user to whitelist
        async function addUser() {
            const userId = document.getElementById('userId').value.trim();
            const username = document.getElementById('username').value.trim();
            
            if (!userId || !username) {
                showStatus('Please fill in both User ID and Username', 'error');
                return;
            }
            
            if (isNaN(userId) || userId.length < 6) {
                showStatus('Please enter a valid Roblox User ID (numbers only)', 'error');
                return;
            }
            
            // Initialize data if needed
            if (!currentData) {
                createDefaultData();
            }
            
            // Check if user already exists
            if (currentData.users.some(u => u.userId === userId)) {
                showStatus(`User ${userId} is already whitelisted`, 'error');
                return;
            }
            
            const newUser = {
                userId: userId,
                username: username,
                profileImage: `https://tr.rbxcdn.com/${userId}/150/150/Image/Png`,
                addedAt: new Date().toISOString(),
                addedBy: 'dashboard'
            };
            
            // Show loading
            const addBtn = document.querySelector('.add-btn');
            const originalText = addBtn.textContent;
            addBtn.textContent = 'Adding...';
            addBtn.disabled = true;
            
            try {
                // Add to local data
                currentData.users.push(newUser);
                currentData.lastUpdated = new Date().toISOString();
                
                // Save to localStorage
                localStorage.setItem(WHITELIST_DATA_KEY, JSON.stringify(currentData));
                
                // Update display
                updateDisplay();
                
                // Clear form
                document.getElementById('userId').value = '';
                document.getElementById('username').value = '';
                
                showStatus(`‚úÖ Added ${username} (${userId}) to whitelist!`, 'success');
                
                // Try to update GitHub via our API
                await updateGitHubViaAPI();
                
            } catch (error) {
                console.error('Error adding user:', error);
                showStatus('Error adding user: ' + error.message, 'error');
                // Revert
                currentData.users.pop();
            } finally {
                addBtn.textContent = originalText;
                addBtn.disabled = false;
            }
        }
        
        // Remove user from whitelist
        async function removeUser(userId) {
            if (!confirm(`Remove user ID ${userId} from whitelist?`)) return;
            
            if (!currentData) return;
            
            const index = currentData.users.findIndex(u => u.userId === userId);
            if (index === -1) return;
            
            const removedUser = currentData.users[index];
            
            // Remove from array
            currentData.users.splice(index, 1);
            currentData.lastUpdated = new Date().toISOString();
            
            // Save to localStorage
            localStorage.setItem(WHITELIST_DATA_KEY, JSON.stringify(currentData));
            
            // Update display
            updateDisplay();
            
            showStatus(`Removed ${removedUser.username || 'user'} (${userId}) from whitelist`, 'success');
            
            // Try to update GitHub
            await updateGitHubViaAPI();
        }
        
        // Update GitHub via API (if you create this endpoint later)
        async function updateGitHubViaAPI() {
            try {
                // This would update your GitHub file
                // For now, just note that changes are local
                console.log('Changes saved locally. To update GitHub, you need a backend API.');
                
                // You could create an API endpoint later at:
                // ${YOUR_VERCEL_URL}/api/update-whitelist
                
            } catch (error) {
                console.log('GitHub update not configured');
            }
        }
        
        // Show status message
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 5000);
        }
        
        // Auto-fetch Roblox username
        document.getElementById('userId').addEventListener('blur', async function() {
            const userId = this.value.trim();
            const usernameField = document.getElementById('username');
            
            if (userId && !usernameField.value) {
                // Try to get username from Roblox API
                try {
                    const response = await fetch(`https://users.roblox.com/v1/users/${userId}`);
                    if (response.ok) {
                        const data = await response.json();
                        usernameField.value = data.name || '';
                        if (data.name) {
                            showStatus(`‚úÖ Found username: ${data.name}`, 'success');
                        }
                    }
                } catch (error) {
                    // User can enter manually
                    usernameField.placeholder = "Enter username for ID: " + userId;
                }
            }
        });
        
        // Load data on page load
        document.addEventListener('DOMContentLoaded', loadInitialData);
        
        // Auto-refresh every 30 seconds
        setInterval(loadFromGitHub, 30000);
        
        // Export for console debugging
        window.WhitelistDashboard = {
            load: loadInitialData,
            data: () => currentData,
            addUser: addUser,
            removeUser: removeUser,
            apiUrl: YOUR_VERCEL_URL
        };
        
        console.log('Dashboard initialized for:', YOUR_VERCEL_URL);
    </script>
</body>
</html>
