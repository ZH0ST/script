<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whitelist Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: #0a0a0a; color: white; min-height: 100vh; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .header { text-align: center; padding: 30px 0; background: linear-gradient(90deg, #1a1a2e, #16213e); border-radius: 10px; margin-bottom: 30px; }
        .header h1 { color: #00aaff; font-size: 2.5rem; margin-bottom: 10px; }
        .header p { color: #aaa; }
        
        .dashboard { display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        
        .users-list { background: #111; border-radius: 10px; padding: 20px; }
        .users-list h2 { color: #00aaff; margin-bottom: 20px; }
        
        .user-card { background: #222; border-radius: 8px; padding: 15px; margin-bottom: 15px; display: flex; align-items: center; border-left: 4px solid #00aaff; }
        .user-avatar { width: 50px; height: 50px; border-radius: 50%; margin-right: 15px; border: 2px solid #00aaff; }
        .user-info { flex: 1; }
        .user-name { font-weight: bold; color: white; }
        .user-id { color: #aaa; font-size: 0.9rem; }
        .remove-btn { background: #ff4444; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; }
        
        .add-user { background: #111; border-radius: 10px; padding: 20px; }
        .add-user h2 { color: #00ffaa; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; color: #88ccff; margin-bottom: 5px; }
        .form-group input { width: 100%; padding: 10px; background: #222; border: 1px solid #00aaff; border-radius: 5px; color: white; }
        .add-btn { width: 100%; padding: 12px; background: #00aaff; color: white; border: none; border-radius: 5px; font-size: 1rem; cursor: pointer; }
        .add-btn:hover { background: #0088cc; }
        
        .status { padding: 10px; border-radius: 5px; margin-top: 10px; text-align: center; display: none; }
        .success { background: rgba(0,255,0,0.1); color: #00ff00; border: 1px solid #00ff00; }
        .error { background: rgba(255,0,0,0.1); color: #ff5555; border: 1px solid #ff5555; }
        
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: #222; padding: 15px; border-radius: 8px; text-align: center; }
        .stat-number { font-size: 2rem; color: #00ffaa; font-weight: bold; }
        .stat-label { color: #aaa; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ”’ Whitelist Dashboard</h1>
            <p>Manage who can access your Roblox script</p>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalUsers">0</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="lastUpdated">-</div>
                <div class="stat-label">Last Updated</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="apiStatus">Online</div>
                <div class="stat-label">API Status</div>
            </div>
        </div>
        
        <div class="dashboard">
            <div class="users-list">
                <h2>Whitelisted Users</h2>
                <div id="usersContainer">
                    <!-- Users will be loaded here -->
                </div>
            </div>
            
            <div class="add-user">
                <h2>Add User</h2>
                <div class="form-group">
                    <label>Roblox User ID:</label>
                    <input type="number" id="userId" placeholder="e.g., 10428355122">
                </div>
                <div class="form-group">
                    <label>Roblox Username:</label>
                    <input type="text" id="username" placeholder="e.g., RobloxUser">
                </div>
                <button class="add-btn" onclick="addUser()">Add to Whitelist</button>
                <div class="status" id="status"></div>
            </div>
        </div>
    </div>

    <script>
        // GitHub Repository Info
        const GITHUB_USERNAME = 'ZH0ST'; // Your GitHub username
        const REPO_NAME = 'key'; // Your repository name
        const GITHUB_TOKEN = ''; // Leave empty for public repo
        const FILE_PATH = 'whitelisted-users.json';
        
        // API URLs
        const RAW_URL = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${REPO_NAME}/main/${FILE_PATH}`;
        const API_URL = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_PATH}`;
        
        let currentData = null;
        let currentSha = null;
        
        // Load whitelist data
        async function loadWhitelist() {
            try {
                const response = await fetch(RAW_URL + '?t=' + Date.now());
                const data = await response.json();
                currentData = data;
                
                // Update stats
                document.getElementById('totalUsers').textContent = data.users.length;
                document.getElementById('lastUpdated').textContent = new Date(data.lastUpdated).toLocaleDateString();
                
                // Display users
                displayUsers(data.users);
                
                // Get file SHA for updates
                if (GITHUB_TOKEN) {
                    const metaResponse = await fetch(API_URL, {
                        headers: GITHUB_TOKEN ? { 'Authorization': `token ${GITHUB_TOKEN}` } : {}
                    });
                    const metaData = await metaResponse.json();
                    currentSha = metaData.sha;
                }
                
                showStatus('Data loaded successfully!', 'success');
            } catch (error) {
                console.error('Error loading data:', error);
                showStatus('Error loading data', 'error');
            }
        }
        
        // Display users in list
        function displayUsers(users) {
            const container = document.getElementById('usersContainer');
            container.innerHTML = '';
            
            if (users.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No whitelisted users yet</div>';
                return;
            }
            
            users.forEach(user => {
                const userCard = document.createElement('div');
                userCard.className = 'user-card';
                userCard.innerHTML = `
                    <img src="${user.profileImage || 'https://tr.rbxcdn.com/5280b2c9e6b95b44e1c2e5c5a2b5b5b5/150/150/Image/Png'}" 
                         class="user-avatar" alt="${user.username}">
                    <div class="user-info">
                        <div class="user-name">${user.username}</div>
                        <div class="user-id">ID: ${user.userId}</div>
                        <div style="color: #888; font-size: 0.8rem; margin-top: 5px;">
                            Added: ${new Date(user.addedAt).toLocaleDateString()}
                        </div>
                    </div>
                    <button class="remove-btn" onclick="removeUser('${user.userId}')">Remove</button>
                `;
                container.appendChild(userCard);
            });
        }
        
        // Add user to whitelist
        async function addUser() {
            const userId = document.getElementById('userId').value.trim();
            const username = document.getElementById('username').value.trim();
            
            if (!userId || !username) {
                showStatus('Please fill all fields', 'error');
                return;
            }
            
            // Check if user already exists
            if (currentData.users.some(u => u.userId === userId)) {
                showStatus('User already whitelisted', 'error');
                return;
            }
            
            const newUser = {
                userId: userId,
                username: username,
                profileImage: `https://tr.rbxcdn.com/${userId}/150/150/Image/Png`,
                addedAt: new Date().toISOString(),
                addedBy: 'dashboard'
            };
            
            // Add to current data
            currentData.users.push(newUser);
            currentData.lastUpdated = new Date().toISOString();
            
            // Update GitHub file
            const success = await updateGitHubFile();
            
            if (success) {
                showStatus('User added to whitelist!', 'success');
                loadWhitelist(); // Reload data
                document.getElementById('userId').value = '';
                document.getElementById('username').value = '';
            } else {
                showStatus('Error updating whitelist', 'error');
                // Revert changes
                currentData.users.pop();
            }
        }
        
        // Remove user from whitelist
        async function removeUser(userId) {
            if (!confirm('Remove this user from whitelist?')) return;
            
            const index = currentData.users.findIndex(u => u.userId === userId);
            if (index === -1) return;
            
            // Remove user
            currentData.users.splice(index, 1);
            currentData.lastUpdated = new Date().toISOString();
            
            // Update GitHub file
            const success = await updateGitHubFile();
            
            if (success) {
                showStatus('User removed from whitelist', 'success');
                loadWhitelist(); // Reload data
            } else {
                showStatus('Error removing user', 'error');
                // Revert changes
                currentData.users.splice(index, 0, currentData.users[index]);
            }
        }
        
        // Update GitHub file
        async function updateGitHubFile() {
            if (!GITHUB_TOKEN) {
                showStatus('GitHub token required for updates', 'error');
                return false;
            }
            
            try {
                const content = JSON.stringify(currentData, null, 2);
                const encodedContent = btoa(unescape(encodeURIComponent(content)));
                
                const updateData = {
                    message: `Update whitelist - ${new Date().toISOString()}`,
                    content: encodedContent,
                    sha: currentSha
                };
                
                const response = await fetch(API_URL, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    currentSha = result.content.sha;
                    return true;
                } else {
                    console.error('GitHub API error:', await response.text());
                    return false;
                }
            } catch (error) {
                console.error('Error updating file:', error);
                return false;
            }
        }
        
        // Show status message
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            setTimeout(() => status.style.display = 'none', 3000);
        }
        
        // Auto-suggest username from User ID
        document.getElementById('userId').addEventListener('blur', async function() {
            const userId = this.value.trim();
            if (userId && !document.getElementById('username').value) {
                // You could add Roblox API call here to get username
                // For now, just suggest
                document.getElementById('username').placeholder = "Enter username for ID: " + userId;
            }
        });
        
        // Load data on page load
        document.addEventListener('DOMContentLoaded', loadWhitelist);
        
        // Auto-refresh every 30 seconds
        setInterval(loadWhitelist, 30000);
    </script>
</body>
</html>
